<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Juno 60 demo</title>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        background-color: #ddd;
      }

      .control-block {
        display: inline-block;
        border: 1px solid silver;
        padding: 3px;
        border-bottom: 5px solid red;
        position: relative;
        margin-bottom: 5px;
        vertical-align: top;
        background-color: #efe;
      }
      .control-block h2 {
        padding: 3px 8px 1px;
        background-color: #f33;
        color: white;
        text-align: center;
        margin: -3px -3px 5px -3px;
        text-shadow: -1px -1px black;
        border-bottom: 1px solid silver;
        font-size: 1.5em;
      }

      .control > * {
        display: block;
        margin: 0 auto 5px;
      }
      .control,
      .control-group {
        display: inline-block;
        border: 1px solid silver;
        min-width: 40px;
        padding: 3px 3px 3px 3px;
        height: 210px;
        position: relative;
        text-align: center;
        vertical-align: top;
      }
      .control-group .control {
        border-width: 0;
        padding: 0;
        height: 204px;
      }

      .control > .control-label {
        font-weight: bold;
        height: 18px;
      }

      .control-slider > span {
        border: 1px solid silver;
        width: 34px;
        height: 20px;
        color: silver;
        padding: 3px 0;
        line-height: 1;
      }
      .control-slider > div {
        width: 20px;
      }

      .radio-buttons {
        text-align: left;
        margin-top: 30px;
        padding: 0 3px;
        line-height: 30px;
      }
      .radio-buttons div {
        border: 1px dotted silver;
        margin-bottom: 3px;
        border-radius: 12px;
        padding-right: 3px;
      }
      .radio-buttons span {
        margin-right: 5px;
        float: left;
      }

      .hpf-width {
        min-width: 58px;
      }
      .chorus-width {
        min-width: 89px;
      }

      #patch-list {
        list-style-type: none;
        padding: 5px;
        column-width: 140px;
      }
      #patch-list a {
        padding: 5px;
      }

      #piano {
        margin-top: 10px;
      }
    </style>

    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/nexusui@2.0.13/dist/NexusUI.min.js"></script>
  </head>
  <body class="show-synth-controls">
    <div id="synth-container">
      <div id="synth-controls">
        <h1>Controls</h1>

        <div class="control-block">
          <h2>LFO</h2>
          <div class="control control-slider">
            <label class="control-label" title="Speed of the LFO (between 0.3 and 20 Hz)"
              >Rate</label
            >
            <div id="lfo-rate"></div>
          </div>
          <div class="control control-slider">
            <label class="control-label">Delay</label>
            <div id="lfo-delay"></div>
          </div>
          <div class="control control-radio-group">
            <label class="control-label">Trig mode</label>
            <div class="radio-buttons">
              <div><span id="lfo-trigger-mode-auto"></span>Auto</div>
              <div><span id="lfo-trigger-mode-manual"></span>Man</div>
            </div>
          </div>
        </div>

        <div class="control-block">
          <h2>DCO</h2>
          <div class="control control-slider">
            <label class="control-label">LFO</label>
            <div id="dco-lfo-depth"></div>
          </div>
          <div class="control control-group">
            <div class="control control-slider">
              <label class="control-label">PWM</label>
              <div id="dco-pwm-depth"></div>
            </div>
            <div class="control control-radio-group">
              <label class="control-label"></label>
              <div class="radio-buttons">
                <div><span id="dco-pwm-source-lfo"></span>LFO</div>
                <div><span id="dco-pwm-source-manual"></span>Man</div>
                <div><span id="dco-pwm-source-env"></span>Env</div>
              </div>
            </div>
            <div class="control control-slider">
              <label class="control-label">Pulse</label>
              <div id="dco-pulse-level"></div>
            </div>
          </div>
          <div class="control control-slider">
            <label class="control-label">Saw</label>
            <div id="dco-saw-level"></div>
          </div>
          <div class="control control-slider">
            <label class="control-label">Sub</label>
            <div id="dco-sub-level"></div>
          </div>
          <div class="control control-slider">
            <label class="control-label">Noise</label>
            <div id="dco-noise-level"></div>
          </div>
        </div>

        <div class="control-block">
          <h2>HPF</h2>
          <div class="control control-slider hpf-width">
            <label class="control-label">Freq</label>
            <div id="hpf-freq"></div>
          </div>
        </div>

        <div class="control-block">
          <h2>VCF</h2>
          <div class="control control-slider">
            <label class="control-label">Freq</label>
            <div id="vcf-freq"></div>
          </div>
          <div class="control control-slider">
            <label class="control-label">Res</label>
            <div id="vcf-resonance"></div>
          </div>
          <div class="control control-group">
            <div class="control control-radio-group">
              <label class="control-label"></label>
              <div class="radio-buttons">
                <div><span id="vcf-polarity-positive"></span>+</div>
                <div><span id="vcf-polarity-negative"></span>-</div>
              </div>
            </div>
            <div
              class="control control-slider"
              title="Amount of Envelope modulation for filter cutoff frequency"
            >
              <label class="control-label">Env</label>
              <div id="vcf-env"></div>
            </div>
          </div>
          <div
            class="control control-slider"
            title="Amount of LFO modulation for filter cutoff frequency"
          >
            <label class="control-label">LFO</label>
            <div id="vcf-lfo"></div>
          </div>
          <div
            class="control control-slider"
            title="Amount of keyboard-tracking for filter cutoff frequency"
          >
            <label class="control-label">Key</label>
            <div id="vcf-key"></div>
          </div>
        </div>

        <div class="control-block">
          <h2>VCA</h2>
          <div class="control control-group">
            <div class="control control-radio-group">
              <label class="control-label"></label>
              <div class="radio-buttons">
                <div><span id="vca-source-env"></span>Env</div>
                <div><span id="vca-source-gate"></span>Gate</div>
              </div>
            </div>
            <div class="control control-slider" title="Amplitude level">
              <label class="control-label">Level</label>
              <div id="vca-level"></div>
            </div>
          </div>
        </div>

        <div class="control-block">
          <h2>ENV</h2>
          <div class="control control-slider" title="Attack rate (0=fast, 10=slooow)">
            <label class="control-label">A</label>
            <div id="env-attack"></div>
          </div>
          <div class="control control-slider" title="Decay rate (0=fast, 10=slooow)">
            <label class="control-label">D</label>
            <div id="env-decay"></div>
          </div>
          <div class="control control-slider" title="Sustain level (until note is released)">
            <label class="control-label">S</label>
            <div id="env-sustain"></div>
          </div>
          <div class="control control-slider" title="Release rate (0=fast, 10=slooow)">
            <label class="control-label">R</label>
            <div id="env-release"></div>
          </div>
        </div>

        <div class="control-block">
          <h2>Chorus</h2>
          <div class="control control-radio-group chorus-width">
            <label class="control-label">Mode</label>
            <div class="radio-buttons">
              <div><span id="chorus-mode-0"></span>Off</div>
              <div><span id="chorus-mode-1"></span>I</div>
              <div><span id="chorus-mode-2"></span>II</div>
              <div><span id="chorus-mode-3"></span>I+II</div>
            </div>
          </div>
        </div>
      </div>

      <div id="synth-patches">
        <h1>Patches</h1>
        <div>
          <ul id="patch-list">
            <li><a href="javascript:">Strings I</a></li>
            <li><a href="javascript:">Strings II</a></li>
            <li><a href="javascript:">Strings III</a></li>
            <li><a href="javascript:">Organ I</a></li>
            <li><a href="javascript:">Organ II</a></li>
            <li><a href="javascript:">Organ III</a></li>
            <li><a href="javascript:">Brass</a></li>
            <li><a href="javascript:">Phase Brass</a></li>
            <li><a href="javascript:">Piano I</a></li>
            <li><a href="javascript:">Piano II</a></li>
            <li><a href="javascript:">Celesta</a></li>
            <li><a href="javascript:">Mellow Piano</a></li>
            <li><a href="javascript:">Harpsichord I</a></li>
            <li><a href="javascript:">Harpsichord II</a></li>
            <li><a href="javascript:">Synthetiser Harp</a></li>
            <li><a href="javascript:">Bass I</a></li>
            <li><a href="javascript:">Bass II</a></li>
            <li><a href="javascript:">Clavichord I</a></li>
            <li><a href="javascript:">Clavichord II</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div id="piano"></div>

    <script type="module">
      const lfoRate = createSlider('#lfo-rate')
      const lfoDelay = createSlider('#lfo-delay')
      const lfoTriggerMode = createCheckButtons({
        true: '#lfo-trigger-mode-auto',
        false: '#lfo-trigger-mode-manual',
      })
      const dcoLfoDepth = createSlider('#dco-lfo-depth')
      const dcoPwmDepth = createSlider('#dco-pwm-depth')
      const dcoPwmSource = createCheckButtons({
        l: '#dco-pwm-source-lfo',
        m: '#dco-pwm-source-manual',
        e: '#dco-pwm-source-env',
      })
      const dcoPulseLevel = createSlider('#dco-pulse-level')
      const dcoSawLevel = createSlider('#dco-saw-level')
      const dcoSubLevel = createSlider('#dco-sub-level')
      const dcoNoiseLevel = createSlider('#dco-noise-level')

      const hpfFreq = createSlider('#hpf-freq')

      const vcfFreq = createSlider('#vcf-freq')
      const vcfResonance = createSlider('#vcf-resonance')
      const vcfPolarity = createCheckButtons({
        true: '#vcf-polarity-positive',
        false: '#vcf-polarity-negative',
      })
      const vcfEnv = createSlider('#vcf-env')
      const vcfLfo = createSlider('#vcf-lfo')
      const vcfKey = createSlider('#vcf-key')

      const vcaSource = createCheckButtons({
        env: '#vca-source-env',
        gate: '#vca-source-gate',
      })
      const vcaLevel = createSlider('#vca-level')

      const envAttack = createSlider('#env-attack')
      const envDecay = createSlider('#env-decay')
      const envSustain = createSlider('#env-sustain')
      const envRelease = createSlider('#env-release')

      const chorusMode = createCheckButtons({
        0: '#chorus-mode-0',
        1: '#chorus-mode-1',
        2: '#chorus-mode-2',
        3: '#chorus-mode-3',
      })

      const piano = new Nexus.Piano('#piano', {
        lowNote: 24,
        highNote: 60,
        mode: 'button',
        size: [1000, 200],
      })

      function createCheckButtons(keyToIdMap) {
        let value = null

        const keyToNexusElementMap = {}
        for (let v of Object.keys(keyToIdMap)) {
          const vcopy = v
          const control = new Nexus.Button(keyToIdMap[vcopy], { size: [30, 30], mode: 'toggle' })

          if (value === null) {
            control.state = true
            value = v
          }

          control.on('change', (state) => {
            if (state ^ (value === vcopy)) {
              setValue(vcopy)
              onControlChange()
            }
          })

          keyToNexusElementMap[v] = control
        }

        function setValue(newValue) {
          if (keyToNexusElementMap[newValue] !== undefined) {
            value = newValue
            for (let v of Object.keys(keyToIdMap)) {
              const newState = v === newValue
              if (keyToNexusElementMap[v].state !== newState) {
                keyToNexusElementMap[v].state = newState
              }
            }
          }
        }

        return {
          getValue: () => value,
          setValue: setValue,
        }
      }

      function createSlider(id) {
        const digitsControl = document.createElement('span')
        digitsControl.innerText = '0.0'

        const control = new Nexus.Slider(id, { size: [40, 150], min: 0, max: 10, step: 0.1 }).on(
          'change',
          (v) => {
            digitsControl.innerText = v.toFixed(1)
            onControlChange()
          }
        )

        control.parent.parentElement.insertBefore(digitsControl, control.parent)

        return control
      }

      function onControlChange() {
        const patch = {
          lfo: {
            rate: lfoRate.value,
            delay: lfoDelay.value,
          },
        }
        console.log(patch)
      }
    </script>
  </body>
</html>
